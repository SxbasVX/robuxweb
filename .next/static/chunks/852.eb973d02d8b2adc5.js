"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[852],{5852:function(e,t,r){r.r(t),r.d(t,{default:function(){return T}});var a=r(7437),s=r(2265),l=r(1180);class i{set(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaultTTL;this.cache.set(e,{data:t,timestamp:Date.now(),expiry:Date.now()+r})}get(e){let t=this.cache.get(e);return t?Date.now()>t.expiry?(this.cache.delete(e),null):t.data:null}invalidate(e){for(let t of this.cache.keys())t.includes(e)&&this.cache.delete(t)}clear(){this.cache.clear()}constructor(){this.cache=new Map,this.defaultTTL=3e5}}let o=new i;async function n(e){let t="posts_".concat(e),r=o.get(t);if(r)return r;let a=(0,l.S)(),{data:s,error:i}=await a.from("posts").select("*").eq("grupo",e).order("fechaCreacion",{ascending:!1}).limit(100);if(i)throw i;let n=null!=s?s:[];return o.set(t,n,12e4),n}async function d(e,t){let r=(0,l.S)(),{data:a,error:s}=await r.rpc("create_post_with_media",{p_autor:t.autor,p_rol:t.rol,p_grupo:e,p_titulo:t.titulo||"",p_contenido:t.contenido,p_autor_nombre:t.autorNombre||null,p_status:t.status||"published",p_youtube_url:t.youtube_url||null});if(s)throw console.error("Error creating post via RPC:",s),s;return a}async function c(e,t,r,a,s){let i=(0,l.S)(),{data:o,error:n}=await i.rpc("smart_increment_reaction",{p_table:"post"===e?"posts":"comentarios",p_id:"post"===e?r:s,p_emoji:a,p_ip_address:null});if(n)throw n;return o}function u(e){let{url:t}=e,r=t.toLowerCase();if(r.includes("drive.google.com")){let e=t.match(/\/d\/([a-zA-Z0-9_-]+)/),r=e?e[1]:null,s=t;return r&&(s="https://drive.google.com/file/d/".concat(r,"/preview")),s=s.split("?")[0],(0,a.jsxs)("div",{className:"glass rounded-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 bg-black/20 text-center",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-2",children:"\uD83C\uDFAC Video de Google Drive"}),(0,a.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"Ver en Drive"})]}),(0,a.jsx)("iframe",{src:s,className:"w-full h-96",allow:"autoplay",title:"Google Drive Video",frameBorder:"0"})]})}if(r.endsWith(".pdf"))return(0,a.jsxs)("div",{className:"glass rounded-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 bg-black/20 text-center",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-2",children:"\uD83D\uDCC4 Documento PDF"}),(0,a.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"Ver PDF en nueva pesta\xf1a"})]}),(0,a.jsx)("iframe",{src:t,className:"w-full h-96",title:"PDF Viewer",frameBorder:"0"})]});if(/(jpg|jpeg|png|gif)$/.test(r)){var s;return(0,a.jsxs)("div",{className:"glass rounded-2xl overflow-hidden",children:[(0,a.jsx)("img",{src:t,alt:"archivo",className:"w-full h-auto",loading:"lazy"}),(0,a.jsxs)("div",{className:"p-2 bg-black/20 text-center text-xs text-gray-400",children:["Imagen • ",null===(s=t.split(".").pop())||void 0===s?void 0:s.toUpperCase()]})]})}return r.endsWith(".mp4")?(0,a.jsxs)("div",{className:"glass rounded-2xl overflow-hidden",children:[(0,a.jsx)("video",{src:t,controls:!0,className:"w-full"}),(0,a.jsx)("div",{className:"p-2 bg-black/20 text-center text-xs text-gray-400",children:"Video MP4"})]}):(0,a.jsxs)("div",{className:"glass p-4 rounded-2xl text-center",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-2",children:"\uD83D\uDCC4 Archivo adjunto"}),(0,a.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",className:"text-blue-400 hover:text-blue-300 underline break-all",children:"Ver archivo"})]})}let m=["\uD83D\uDC4D","❤️","\uD83D\uDE02","\uD83D\uDD25","\uD83D\uDE22"],p=(0,s.memo)(function(e){let{counts:t={},onReact:r}=e,[l,i]=(0,s.useState)(null),[o,n]=(0,s.useState)(null),d=(0,s.useCallback)(async e=>{if(!o){i(e),n(e);try{await (null==r?void 0:r(e))}catch(e){console.error("Error reacting:",e)}finally{n(null),setTimeout(()=>i(null),400)}}},[o,r]);return(0,a.jsx)("div",{className:"flex items-center gap-1 sm:gap-2 flex-wrap",children:m.map((e,r)=>{var s;let i=null!==(s=null==t?void 0:t[e])&&void 0!==s?s:0,n=l===e,c=o===e;return(0,a.jsxs)("button",{onClick:()=>d(e),disabled:c,className:"relative px-2 py-1.5 sm:px-3 sm:py-2 rounded-lg text-base sm:text-lg font-medium transition-all duration-300 touch-manipulation select-none animate-fade-in gpu-accelerated ".concat(i>0?"bg-white/20 text-white border border-white/30":"bg-white/5 text-gray-300 border border-white/10 hover:bg-white/10 hover:text-white"," ").concat(n?"scale-110 bg-pink-500/30 border-pink-400/50":""," ").concat(c?"cursor-not-allowed opacity-50":"hover:scale-105"),style:{animationDelay:"".concat(.1*r,"s"),transform:n?"scale(1.1)":"scale(1)"},children:[(0,a.jsx)("span",{className:"block transition-transform duration-200 ".concat(n?"scale-125":""," ").concat(c?"animate-pulse":""),children:e}),i>0&&(0,a.jsx)("span",{className:"ml-1 text-xs font-bold transition-all duration-200 ".concat(n?"text-pink-200":"text-gray-300"),children:i}),c&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"})})]},e)})})});var g=r(6758);let x=[".pdf",".jpg",".jpeg",".png",".gif",".mp4"];var h=r(1581);let b={},f=(0,s.memo)(function(e){var t;let{post:r,onReact:i,canPublish:o,onPublish:n,canDelete:d,onDelete:c,currentUserId:m,currentUserRole:x}=e,f=d||"admin"===x||r.autor===m||m&&r.autor===m.split("@")[0],[v,y]=(0,s.useState)(r.autorNombre),[j,N]=(0,s.useState)(!1),[w,D]=(0,s.useState)({titulo:r.titulo||"",contenido:r.contenido||"",youtube_url:r.youtube_url||"",google_drive_url:r.google_drive_url||""}),[_,C]=(0,s.useState)(!1),[k,S]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=!1;if(v||!r.autor)return;let t=b[r.autor];if(t){y(t);return}return(async()=>{try{let t=(0,l.S)(),{data:a,error:s}=await t.from("users").select("email").eq("id",r.autor).limit(1).maybeSingle();if(s)throw s;let i=((null==a?void 0:a.email)?a.email.split("@")[0]:void 0)||r.autor;e||(b[r.autor]=i,y(i))}catch(t){e||y(r.autor)}})(),()=>{e=!0}},[v,r.autor]),(0,a.jsxs)("article",{className:"post-card space-y-4 transition-all duration-300 animate-fade-in-up",children:[(0,a.jsxs)("header",{className:"post-header flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(g.Z,{user:{id:r.autor,displayName:r.autorNombre||r.autor,email:r.autor.includes("@")?r.autor:void 0},role:r.rol,size:"md",showRole:!0}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"font-semibold text-token",children:v||r.autor}),"admin"===r.rol&&(0,a.jsx)("span",{className:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-xs px-2 py-1 rounded-full border border-purple-200 dark:border-purple-700",children:"\uD83D\uDC51 Administrador"}),"delegado"===r.rol&&(0,a.jsx)("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs px-2 py-1 rounded-full border border-blue-200 dark:border-blue-700",children:"\uD83E\uDDB8 Delegado"})]}),(0,a.jsx)("time",{className:"text-xs muted-token",children:function(e){try{return new Intl.DateTimeFormat("es-ES",{dateStyle:"medium",timeStyle:"short"}).format(new Date(e))}catch(t){return new Date(e).toLocaleString()}}(r.fechaCreacion)})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[r.status&&"published"!==r.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full border ".concat("draft"===r.status?"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-700":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 border-green-200 dark:border-green-700"),children:"draft"===r.status?"Borrador":"Publicado"}),o&&"draft"===r.status&&n&&(0,a.jsx)("button",{onClick:n,className:"btn-primary text-xs px-3 py-1",children:"Publicar"})]}),f&&c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{confirm("\xbfEst\xe1s seguro de que quieres eliminar esta publicaci\xf3n?")&&c()},className:"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 px-2 py-1 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-xs",title:"Eliminar publicaci\xf3n",children:"\uD83D\uDDD1️"}),(0,a.jsx)("button",{onClick:()=>N(!0),className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300 px-2 py-1 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors text-xs",title:"Editar publicaci\xf3n",children:"✏️"})]})]})]}),(0,a.jsx)("main",{className:"space-y-4",children:(0,a.jsx)("div",{className:"space-y-3 animate-fade-in-up",style:{animationDelay:"0.1s"},children:(0,a.jsxs)("div",{className:"text-token",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)("span",{className:"font-semibold",children:v||r.autor}),(0,a.jsx)("span",{className:"muted-token",children:"→"}),(0,a.jsxs)("span",{className:"font-medium",style:{color:"var(--chip-text)"},children:["Grupo ",r.grupo]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[r.titulo&&(0,a.jsx)("div",{className:"font-semibold text-xl text-token",children:r.titulo}),(0,a.jsx)("div",{className:"post-content",dangerouslySetInnerHTML:{__html:h.Z.sanitize(r.contenido)}}),(0,a.jsx)("div",{className:"flex items-center gap-2 text-xs muted-token",children:(0,a.jsx)("span",{children:"\uD83D\uDC40 0 vistas"})})]})]})})}),r.archivos&&r.archivos.length>0&&(0,a.jsx)("div",{className:"animate-fade-in-up space-y-3",style:{animationDelay:"0.3s"},children:r.archivos.map((e,t)=>(0,a.jsx)(u,{url:e},t))}),r.google_drive_url&&(0,a.jsx)("div",{className:"w-full max-w-3xl mx-auto aspect-video rounded-lg overflow-hidden bg-black animate-fade-in-up",style:{animationDelay:"0.32s"},children:(0,a.jsx)("iframe",{src:(()=>{let e=r.google_drive_url.match(/\/d\/([a-zA-Z0-9_-]+)/),t=e?e[1]:null;return t?"https://drive.google.com/file/d/".concat(t,"/preview"):r.google_drive_url})(),className:"w-full h-full object-contain",style:{aspectRatio:"16/9",background:"black"},allow:"autoplay",title:"Google Drive Video",frameBorder:"0",allowFullScreen:!0})}),r.youtube_url&&(0,a.jsx)("div",{className:"animate-fade-in-up",style:{animationDelay:"0.35s"},children:(0,a.jsxs)("div",{className:"rounded-xl p-4 border",style:{background:"rgba(255,255,255,0.06)",borderColor:"var(--card-border)"},children:[(0,a.jsx)("div",{className:"aspect-video rounded-lg overflow-hidden",children:(0,a.jsx)("iframe",{src:"https://www.youtube.com/embed/".concat((null===(t=r.youtube_url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/))||void 0===t?void 0:t[1])||""),title:"Video de YouTube",className:"w-full h-full",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2 text-sm muted-token",children:[(0,a.jsx)("span",{children:"\uD83C\uDFA5"}),(0,a.jsx)("span",{children:"Video de YouTube"})]})]})}),j&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"glass p-6 w-full max-w-lg mx-2 rounded-2xl shadow-2xl border border-white/10",style:{background:"rgba(30,32,40,0.85)"},children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-white",children:"Editar publicaci\xf3n"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("input",{type:"text",className:"w-full px-4 py-2 rounded-lg border border-white/20 bg-white/10 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"T\xedtulo",value:w.titulo,onChange:e=>D(t=>({...t,titulo:e.target.value}))}),(0,a.jsx)("textarea",{className:"w-full px-4 py-2 rounded-lg border border-white/20 bg-white/10 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Contenido",rows:4,value:w.contenido,onChange:e=>D(t=>({...t,contenido:e.target.value}))}),(0,a.jsx)("input",{type:"url",className:"w-full px-4 py-2 rounded-lg border border-white/20 bg-white/10 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"URL de YouTube",value:w.youtube_url,onChange:e=>D(t=>({...t,youtube_url:e.target.value}))}),(0,a.jsx)("input",{type:"url",className:"w-full px-4 py-2 rounded-lg border border-white/20 bg-white/10 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"URL de Google Drive",value:w.google_drive_url,onChange:e=>D(t=>({...t,google_drive_url:e.target.value}))}),k&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:k})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[(0,a.jsx)("button",{className:"flex-1 bg-gradient-to-r from-blue-600 to-blue-400 hover:from-blue-700 hover:to-blue-500 text-white px-4 py-2 rounded-lg font-semibold",disabled:_,onClick:async()=>{C(!0),S(null);try{let e=(0,l.S)(),{error:t}=await e.from("posts").update({titulo:w.titulo,contenido:w.contenido,youtube_url:w.youtube_url,google_drive_url:w.google_drive_url}).eq("id",r.id);if(t)throw t;N(!1),window.location.reload()}catch(e){S("Error al guardar los cambios")}finally{C(!1)}},children:"Guardar cambios"}),(0,a.jsx)("button",{className:"flex-1 bg-gradient-to-r from-gray-500 to-gray-400 hover:from-gray-600 hover:to-gray-500 text-white px-4 py-2 rounded-lg font-semibold",onClick:()=>N(!1),disabled:_,children:"Cancelar"})]})]})}),(0,a.jsx)("footer",{className:"pt-4 border-t",style:{borderColor:"var(--card-border)"},children:(0,a.jsx)("div",{className:"animate-fade-in-up",style:{animationDelay:"0.4s"},children:(0,a.jsx)(p,{counts:r.reacciones,onReact:i})})})]})});async function v(e,t,r){let a=[],s=(0,l.S)();for(let r of t){if(r.size>10485760)throw Error("Archivo demasiado grande (>10MB)");let t=function(e){let t=e.toLowerCase();for(let e of x)if(t.endsWith(e))return e;return null}(r.name);if(!t)throw Error("Extensi\xf3n no permitida");let l=Date.now(),i="".concat(l).concat(t),o="grupos/".concat(e,"/").concat(i),{error:n}=await s.storage.from("grupos").upload(o,r,{upsert:!0});if(n)throw Error("Error subiendo archivo: ".concat(n.message));let{data:d}=s.storage.from("grupos").getPublicUrl(o);a.push(d.publicUrl)}return a}async function y(e,t,r){return v(e,r,{postId:t})}var j=r(3259);class N{cleanup(){let e=Date.now();for(let[t,r]of this.store.entries())r.resetTime<e&&(!r.blockedUntil||r.blockedUntil<e)&&this.store.delete(t)}getClientId(e){{let e=localStorage.getItem("client_id");return e||(e=crypto.randomUUID(),localStorage.setItem("client_id",e)),e}}checkLimit(e,t){let r=this.getClientId(t),a="".concat(r,":").concat(e),s=Date.now(),l=this.store.get(a);return(null==l?void 0:l.blockedUntil)&&l.blockedUntil>s?{allowed:!1,retryAfter:Math.ceil((l.blockedUntil-s)/1e3)}:!l||l.resetTime<=s?(l={count:1,resetTime:s+this.config.windowMs},this.store.set(a,l),{allowed:!0,resetTime:l.resetTime}):(l.count++,l.count>this.config.maxRequests)?(l.blockedUntil=s+this.config.blockDurationMs,this.store.set(a,l),{allowed:!1,retryAfter:Math.ceil(this.config.blockDurationMs/1e3)}):(this.store.set(a,l),{allowed:!0,resetTime:l.resetTime})}getRemainingRequests(e,t){let r=this.getClientId(t),a="".concat(r,":").concat(e),s=this.store.get(a);return!s||s.resetTime<=Date.now()?this.config.maxRequests:Math.max(0,this.config.maxRequests-s.count)}constructor(e){this.store=new Map,this.config=e,setInterval(()=>this.cleanup(),3e5)}}let w={posts:new N({maxRequests:10,windowMs:36e5,blockDurationMs:18e5}),comments:new N({maxRequests:30,windowMs:36e5,blockDurationMs:9e5}),reactions:new N({maxRequests:100,windowMs:36e5,blockDurationMs:3e5}),auth:new N({maxRequests:5,windowMs:9e5,blockDurationMs:36e5}),uploads:new N({maxRequests:20,windowMs:36e5,blockDurationMs:18e5})};var D=r(5506),_=r(7818);r(8416);let C=(0,_.default)(()=>Promise.all([r.e(70),r.e(436)]).then(r.t.bind(r,8436,23)),{loadableGenerated:{webpack:()=>[8436]},ssr:!1});function k(e){let{value:t,onChange:r}=e,l=(0,s.useMemo)(()=>({toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["link","image"],["clean"]]}),[]);return(0,a.jsx)("div",{className:"rounded-xl border",style:{background:"rgba(255,255,255,0.06)",borderColor:"var(--card-border)"},children:(0,a.jsx)("div",{className:"quill-robux",children:(0,a.jsx)(C,{theme:"snow",value:t,onChange:r,modules:l})})})}let S=(0,s.memo)(function(e){var t;let{groupId:r,onPostCreated:i}=e,{user:o,role:n,group:c}=(0,j.a)(),{checkLimit:u,getRemaining:m}=(t="posts",{checkLimit:()=>(function(e,t){let r=w[e];return r?r.checkLimit(e,void 0):(console.warn("Rate limiter not found for action: ".concat(e)),{allowed:!0})})(t),getRemaining:()=>(function(e,t){let r=w[e];return r?r.getRemainingRequests(e,void 0):999})(t)}),[p,g]=(0,s.useState)(""),[x,h]=(0,s.useState)(""),[b,f]=(0,s.useState)(null),[v,N]=(0,s.useState)(""),[_,C]=(0,s.useState)(""),[S,E]=(0,s.useState)("files"),[A,I]=(0,s.useState)(null),[L,M]=(0,s.useState)(!1),[T,U]=(0,s.useState)(!1),[V,G]=(0,s.useState)(m()),R=!!o&&("admin"===n||"delegado"===n&&c===r),z=()=>{var e;if(o)return"admin"===n?"Administrador":"delegado"===n?"Delegado Grupo ".concat(c):o.displayName||(null===(e=o.email)||void 0===e?void 0:e.split("@")[0])||void 0},F=e=>{let t=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/);return t?t[1]:null},q=async e=>{if(!R)return I("No tienes acceso a esta funci\xf3n.");if(!p.trim()||!x.trim())return;let t=u();if(!t.allowed){let e=Math.ceil((t.retryAfter||0)/60);I("Has alcanzado el l\xedmite de publicaciones. Intenta de nuevo en ".concat(e," minutos."));return}I(null),M(!0);try{if(v.trim()&&!F(v.trim())){I("URL de YouTube inv\xe1lida"),M(!1);return}let t=await d(r,{autor:o.id,autorNombre:z(),rol:n,grupo:r,titulo:p.trim(),contenido:x.trim(),archivos:[],youtube_url:v.trim()||void 0,google_drive_url:_.trim()||void 0,status:e}),a=D.ZP.getInstance();if(a.setUser(o),a.log("post_created","info",{groupId:r,postId:t,title:p.trim(),hasFiles:b&&b.length>0,hasYoutube:!!v.trim(),status:e}),b&&b.length>0){let e=await y(r,t,Array.from(b)),a=(0,l.S)(),{error:s}=await a.from("posts").update({archivos:e}).eq("id",t);if(s){console.error("Error actualizando post:",s),I("Error actualizando el post con archivos"),M(!1);return}D.ZP.getInstance().log("file_uploaded","info",{fileCount:b.length,postId:t,groupId:r})}U(!0),g(""),h(""),f(null),N(""),C(""),G(m()),setTimeout(()=>U(!1),3e3),i&&(i(),setTimeout(()=>{i()},500))}catch(t){console.error("Error creating post:",t),I("Error al crear el post"),D.ZP.getInstance().log("post_created","error",{groupId:r,title:p.trim(),status:e,error:t.message})}finally{M(!1)}};return R?(0,a.jsxs)("form",{className:"glass p-6 rounded-2xl space-y-4 animate-slide-up gpu-accelerated",onSubmit:e=>e.preventDefault(),children:[(0,a.jsx)("input",{type:"text",placeholder:"T\xedtulo del post...",value:p,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pink-500 transition-all duration-300",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"animate-fade-in",style:{animationDelay:"0.2s"},children:(0,a.jsx)(k,{value:x,onChange:h})}),(0,a.jsxs)("div",{className:"space-y-4 animate-fade-in",style:{animationDelay:"0.3s"},children:[(0,a.jsxs)("div",{className:"flex rounded-xl bg-white/5 p-1",children:[(0,a.jsx)("button",{type:"button",onClick:()=>E("files"),className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat("files"===S?"bg-pink-500 text-white":"text-gray-400 hover:text-white"),children:"\uD83D\uDCC1 Archivos/Fotos"}),(0,a.jsx)("button",{type:"button",onClick:()=>E("youtube"),className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat("youtube"===S?"bg-pink-500 text-white":"text-gray-400 hover:text-white"),children:"\uD83C\uDFA5 YouTube"}),(0,a.jsx)("button",{type:"button",onClick:()=>E("mixed"),className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat("mixed"===S?"bg-pink-500 text-white":"text-gray-400 hover:text-white"),children:"\uD83D\uDCDA Mixto"})]}),("files"===S||"mixed"===S)&&(0,a.jsx)("input",{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.gif,.webp",onChange:e=>f(e.target.files),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-pink-500 file:text-white hover:file:bg-pink-600 transition-all duration-300",title:"Sube PDFs, im\xe1genes (JPG, PNG, GIF, WebP)"}),("youtube"===S||"mixed"===S)&&(0,a.jsx)("input",{type:"url",placeholder:"URL de YouTube (ej: https://youtube.com/watch?v=...)",value:v,onChange:e=>N(e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pink-500 transition-all duration-300 mb-2"}),(0,a.jsx)("input",{type:"url",placeholder:"URL de Google Drive (ej: https://drive.google.com/file/d/ID/view)",value:_,onChange:e=>C(e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>q("draft"),disabled:L||!p.trim()||!x.trim(),className:"flex-1 bg-gray-600 hover:bg-gray-700 disabled:bg-gray-800 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 animate-slide-up",style:{animationDelay:"0.4s"},children:L?(0,a.jsxs)("span",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2"}),"Guardando..."]}):"Guardar Borrador"}),(0,a.jsx)("button",{type:"button",onClick:()=>q("published"),disabled:L||!p.trim()||!x.trim(),className:"flex-1 bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 disabled:from-gray-600 disabled:to-gray-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 animate-slide-up",style:{animationDelay:"0.5s"},children:"Publicar Post"})]}),A&&(0,a.jsx)("p",{className:"text-red-400 text-sm animate-fade-in",style:{animationDelay:"0.1s"},children:A}),T&&(0,a.jsx)("p",{className:"text-green-400 text-sm animate-fade-in",style:{animationDelay:"0.1s"},children:"\xa1Post creado exitosamente!"}),(0,a.jsxs)("div",{className:"bg-blue-600/20 border border-blue-500/30 rounded-lg p-3 animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-blue-300",children:"\uD83D\uDCCA Posts restantes esta hora:"}),(0,a.jsx)("span",{className:"text-blue-200 font-bold",children:V})]}),V<=3&&(0,a.jsx)("div",{className:"text-yellow-300 text-xs mt-2",children:"⚠️ Acerc\xe1ndote al l\xedmite de publicaciones por hora"})]})]}):(0,a.jsx)("div",{className:"glass p-6 rounded-2xl border border-red-500/20 animate-fade-in",children:(0,a.jsx)("p",{className:"text-red-300 text-center",children:"Solo los administradores y delegados pueden crear posts en este grupo."})})});function E(e){let{groupId:t,currentUser:r,isAdminView:i=!1}=e,[o,n]=(0,s.useState)([]),[d,c]=(0,s.useState)(null),[u,m]=(0,s.useState)(null),[p,x]=(0,s.useState)(null),[h,b]=(0,s.useState)(null),[f,y]=(0,s.useState)("ensayos"),[j,N]=(0,s.useState)({ensayos:[],videos:[],evidencias:[]}),[w,D]=(0,s.useState)(!0),[_,C]=(0,s.useState)(!1),k=[{id:1,members:["Ana Garc\xeda","Luis Mart\xednez","Sofia Rodr\xedguez","Carlos L\xf3pez"]},{id:2,members:["Mar\xeda Hern\xe1ndez","Diego Morales","Elena Vega","Roberto Silva"]},{id:3,members:["Carmen Ruiz","Andr\xe9s Torres","Luc\xeda Jim\xe9nez","Fernando Castro"]},{id:4,members:["Patricia Mendoza","Javier Santos","Isabella Ramos","Miguel Ortega"]},{id:5,members:["Valentina Cruz","Sebasti\xe1n Vargas","Camila Delgado","Nicol\xe1s P\xe9rez"]}];(0,s.useEffect)(()=>{E()},[t]),(0,s.useEffect)(()=>{h&&A(h.id)},[h]);let S=async()=>{if(!confirm("\xbfCrear estudiantes autom\xe1ticamente para este grupo? Esto agregar\xe1 los miembros predefinidos del grupo en la tabla estudiantes."))return;let e=k.find(e=>e.id===parseInt(t));if(!e){alert("No se encontraron datos para este grupo");return}D(!0);try{let r=(0,l.S)();for(let a=0;a<e.members.length;a++){let s=e.members[a],l="".concat(s.toLowerCase().replace(/\s+/g,".").replace(/[áéíóú]/g,e=>({á:"a",é:"e",í:"i",ó:"o",ú:"u"})[e]||e),"@estudiante.com"),{data:i,error:o}=await r.from("estudiantes").upsert({codigo:"AUTO".concat(t).concat(a+1),nombre_completo:s,email:l,grupo:parseInt(t)},{onConflict:"email",ignoreDuplicates:!1}).select();if(o)throw o;console.log("Estudiante creado/actualizado:",i)}alert("".concat(e.members.length," estudiantes creados exitosamente para el Grupo ").concat(t)),E()}catch(e){console.error("Error creando estudiantes:",e),alert("Error al crear los estudiantes")}finally{D(!1)}},E=async()=>{try{let e=(0,l.S)(),{data:r,error:a,count:s}=await e.from("estudiantes").select("id, codigo, nombre_completo, email, grupo",{count:"exact"}).eq("grupo",parseInt(t)).order("nombre_completo",{ascending:!0});if(console.log("[StudentManager] estudiantes data:",r,"error:",a,"count:",s),m("number"==typeof s?s:(null==r?void 0:r.length)||0),x(r||null),a){c("Error loading students: "+a.message),console.error("Error loading students:",a),n([]);return}let i=(null==r?void 0:r.map(e=>{var r;return{id:e.id,email:e.email,role:"usuario",group:(null===(r=e.grupo)||void 0===r?void 0:r.toString())||t,full_name:e.nombre_completo}}))||[];n(i),c(null)}catch(e){c("Error loading students: "+((null==e?void 0:e.message)||e)),console.error("Error loading students:",e),n([])}finally{D(!1)}},A=async e=>{try{let t=(0,l.S)(),{data:r}=await t.from("student_essays").select("id, title, file_url, uploaded_at, file_type").eq("student_id",e),{data:a}=await t.from("posts").select("id, titulo, contenido, archivos, youtube_url, google_drive_url, fechaCreacion").eq("autor",e),s=(null==a?void 0:a.filter(e=>e.youtube_url&&""!==e.youtube_url.trim()||e.google_drive_url&&""!==e.google_drive_url.trim()).map(e=>{let t=!!(e.youtube_url&&""!==e.youtube_url.trim()),r=t?e.youtube_url:e.google_drive_url,a=r;if(!t&&e.google_drive_url){let t=e.google_drive_url.match(/\/d\/([a-zA-Z0-9-_]+)/);t&&(a="https://drive.google.com/file/d/".concat(t[1],"/preview"))}return{id:String(e.id),title:e.titulo||"Video sin t\xedtulo",description:e.contenido||"",url:String(r),embedUrl:String(a),type:t?"youtube":"drive",uploaded_at:String(e.fechaCreacion)}}))||[],i=(null==a?void 0:a.filter(e=>e.archivos&&Array.isArray(e.archivos)&&e.archivos.length>0).flatMap(e=>e.archivos.map((t,r)=>({id:"".concat(e.id,"_").concat(r),title:e.titulo||"Evidencia ".concat(r+1),description:e.contenido||"",file_url:t,type:t.toLowerCase().includes(".pdf")?"pdf":"image",uploaded_at:e.fechaCreacion}))))||[];N({ensayos:r||[],videos:s,evidencias:i})}catch(e){console.error("Error loading student content:",e)}},I=async(e,t,a)=>{if(!r||"admin"!==r.role&&"delegado"!==r.role){alert("❌ No tienes permisos para eliminar ensayos");return}if(confirm('\xbfEst\xe1s seguro de que quieres eliminar el ensayo "'.concat(a,'"?')))try{let r=(0,l.S)();if(t.includes("supabase.co/storage")){let e=t.split("/"),a=e.findIndex(e=>"ensayos"===e)+1,s=e.slice(a).join("/"),{error:l}=await r.storage.from("ensayos").remove(["ensayos/".concat(s)]);l&&console.error("Error eliminando archivo:",l)}let{error:s}=await r.from("student_essays").delete().eq("id",e);if(s)throw s;h&&setTimeout(()=>A(h.id),500),alert('✅ Ensayo "'.concat(a,'" eliminado exitosamente'))}catch(e){console.error("Error eliminando ensayo:",e),alert("❌ Error al eliminar el ensayo: ".concat((null==e?void 0:e.message)||String(e)))}},L=async(e,a)=>{if(h){C(!0);try{let s=(0,l.S)();if("ensayos"===a){let a=(await v(parseInt(t),[e]))[0],l=prompt("T\xedtulo del ensayo:")||e.name.replace(/\.[^/.]+$/,""),i=prompt("Descripci\xf3n del ensayo (opcional):")||"Ensayo subido por ".concat(h.full_name||h.email),{error:o}=await s.from("student_essays").insert({title:l,description:i,file_url:a,student_id:h.id,uploaded_by:(null==r?void 0:r.id)||h.id,group_id:parseInt(t),file_size:e.size,file_type:e.type});if(o)throw o}else{let r=await v(parseInt(t),[e]),a=prompt("T\xedtulo de la evidencia:")||e.name.replace(/\.[^/.]+$/,""),l=prompt("Descripci\xf3n de la evidencia (opcional):")||"",{error:i}=await s.from("posts").insert({titulo:a,contenido:l||"Evidencia: ".concat(a),grupo:parseInt(t),autor:h.id,rol:"usuario",status:"published",archivos:r,reacciones:{},fechaCreacion:Date.now()});if(i)throw i}setTimeout(()=>A(h.id),500),alert("✅ ".concat("ensayos"===a?"Ensayo":"Evidencia",' "').concat(e.name,'" subido exitosamente'))}catch(e){console.error("Error uploading file:",e),alert("❌ Error al subir el archivo: ".concat((null==e?void 0:e.message)||String(e)))}finally{C(!1)}}},M=async()=>{if(!h)return;let e=prompt("URL del video (YouTube o Google Drive):");if(!e)return;let r=prompt("T\xedtulo del video:")||"Video sin t\xedtulo",a=prompt("Descripci\xf3n del video (opcional):")||"",s=e.includes("youtube.com")||e.includes("youtu.be"),i=e.includes("drive.google.com");if(!s&&!i){alert("❌ Solo se permiten videos de YouTube o Google Drive");return}try{let o=(0,l.S)(),n=e;if(i){let t=e.match(/\/d\/([a-zA-Z0-9-_]+)/);t&&(n="https://drive.google.com/file/d/".concat(t[1],"/preview"))}let{error:d}=await o.from("posts").insert({titulo:r,contenido:a||"Video: ".concat(r),grupo:parseInt(t),autor:h.id,rol:"usuario",status:"published",archivos:[],reacciones:{},[s?"youtube_url":"google_drive_url"]:n,fechaCreacion:Date.now()});if(d)throw d;setTimeout(()=>A(h.id),500),alert("✅ Video agregado exitosamente")}catch(e){console.error("Error adding video:",e),alert("❌ Error al agregar el video: ".concat((null==e?void 0:e.message)||String(e)))}};return w?(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})}):h?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:()=>b(null),className:"px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white",children:"← Volver"}),(0,a.jsxs)("h2",{className:"text-2xl font-bold text-white",children:["Gestionar: ",h.full_name||h.email]})]}),(0,a.jsxs)("div",{className:"bg-gray-800/50 rounded-xl border border-gray-600/30",children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsxs)("button",{onClick:()=>y("ensayos"),className:"flex-1 px-6 py-4 text-center font-medium transition-colors ".concat("ensayos"===f?"bg-purple-600/30 text-purple-300 border-b-2 border-purple-500":"text-gray-400 hover:text-white hover:bg-gray-700/30"),children:["\uD83D\uDCC4 Ensayos (",j.ensayos.length,")"]}),(0,a.jsxs)("button",{onClick:()=>y("videos"),className:"flex-1 px-6 py-4 text-center font-medium transition-colors ".concat("videos"===f?"bg-blue-600/30 text-blue-300 border-b-2 border-blue-500":"text-gray-400 hover:text-white hover:bg-gray-700/30"),children:["\uD83C\uDFA5 Videos (",j.videos.length,")"]}),(0,a.jsxs)("button",{onClick:()=>y("evidencias"),className:"flex-1 px-6 py-4 text-center font-medium transition-colors ".concat("evidencias"===f?"bg-green-600/30 text-green-300 border-b-2 border-green-500":"text-gray-400 hover:text-white hover:bg-gray-700/30"),children:["\uD83D\uDCC1 Evidencias (",j.evidencias.length,")"]})]}),(0,a.jsxs)("div",{className:"p-6",children:["ensayos"===f&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"\uD83D\uDCC4 Ensayos"}),(0,a.jsxs)("label",{className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg cursor-pointer",children:[_?"Subiendo...":"+ Subir Ensayo",(0,a.jsx)("input",{type:"file",accept:".pdf",onChange:e=>{var t;return(null===(t=e.target.files)||void 0===t?void 0:t[0])&&L(e.target.files[0],"ensayos")},className:"hidden",disabled:_})]})]}),0===j.ensayos.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"\uD83D\uDCC4 No hay ensayos subidos"}):(0,a.jsx)("div",{className:"space-y-3",children:j.ensayos.map(e=>(0,a.jsx)("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-gray-600/30",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"text-white font-medium",children:e.title}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm",children:["\uD83D\uDCC5 ",new Date(e.uploaded_at).toLocaleDateString()]}),(0,a.jsx)("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",className:"text-purple-400 hover:text-purple-300 text-sm",children:"\uD83D\uDCCE Ver ensayo →"})]}),((null==r?void 0:r.role)==="admin"||(null==r?void 0:r.role)==="delegado")&&(0,a.jsx)("button",{onClick:()=>I(e.id,e.file_url,e.title),className:"ml-3 px-2 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded transition-colors",title:"Eliminar ensayo",children:"\uD83D\uDDD1️"})]})},e.id))})]}),"videos"===f&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"\uD83C\uDFA5 Videos"}),(0,a.jsx)("button",{onClick:M,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:"+ Agregar Video"})]}),0===j.videos.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"\uD83C\uDFA5 No hay videos agregados"}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.videos.map(e=>{var t;let r="youtube"===e.type&&(null===(t=e.embedUrl.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/))||void 0===t?void 0:t[1])||"";return(0,a.jsxs)("div",{className:"bg-gray-900/50 rounded-lg overflow-hidden border border-gray-600/30",children:[(0,a.jsx)("div",{className:"aspect-video bg-gray-800",children:"youtube"===e.type&&r?(0,a.jsx)("iframe",{src:"https://www.youtube.com/embed/".concat(r),title:e.title,className:"w-full h-full",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):"drive"===e.type&&e.embedUrl?(0,a.jsx)("iframe",{src:e.embedUrl,title:e.title,className:"w-full h-full",frameBorder:"0",allow:"autoplay"}):(0,a.jsx)("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center text-gray-400",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83C\uDFA5"}),(0,a.jsx)("div",{children:"Video no disponible"}),(0,a.jsxs)("div",{className:"text-xs mt-1",children:["URL: ",e.embedUrl]})]})})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-2",children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:e.description}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm mb-3",children:["youtube"===e.type?"\uD83D\uDCF9 YouTube":"\uD83D\uDCBE Google Drive"," • ",new Date(e.uploaded_at).toLocaleDateString()]}),(0,a.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:"youtube"===e.type?"\uD83D\uDD17 Ver en YouTube →":"\uD83D\uDD17 Ver en Drive →"})]})]},e.id)})})]}),"evidencias"===f&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"\uD83D\uDCC1 Evidencias"}),(0,a.jsxs)("label",{className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg cursor-pointer",children:[_?"Subiendo...":"+ Subir Evidencia",(0,a.jsx)("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:e=>{var t;return(null===(t=e.target.files)||void 0===t?void 0:t[0])&&L(e.target.files[0],"evidencias")},className:"hidden",disabled:_})]})]}),0===j.evidencias.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"\uD83D\uDCC1 No hay evidencias subidas"}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.evidencias.map(e=>(0,a.jsxs)("div",{className:"bg-gray-900/50 rounded-lg overflow-hidden border border-gray-600/30",children:["image"===e.type?(0,a.jsxs)("div",{className:"aspect-video bg-gray-800",children:[(0,a.jsx)("img",{src:e.file_url,alt:e.title,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.style.display="none",e.currentTarget.nextElementSibling.style.display="flex"}}),(0,a.jsx)("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center text-gray-400",style:{display:"none"},children:"\uD83D\uDDBC️ Imagen no disponible"})]}):(0,a.jsx)("div",{className:"aspect-video bg-gray-800 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-gray-400",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCC4"}),(0,a.jsx)("div",{children:"Documento PDF"})]})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-2",children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:e.description}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm mb-3",children:["pdf"===e.type?"\uD83D\uDCC4 PDF":"\uD83D\uDDBC️ Imagen"," • ",new Date(e.uploaded_at).toLocaleDateString()]}),(0,a.jsx)("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded transition-colors",children:"\uD83D\uDCCE Ver completo →"})]})]},e.id))})]})]})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-purple-600/20 backdrop-blur-sm rounded-xl p-6 border border-purple-500/30",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-white mb-2 flex items-center gap-2",children:["\uD83D\uDC65 ",i?"Panel de Administraci\xf3n":"Espacio de Delegado"," - Grupo ",t]}),(0,a.jsx)("p",{className:"text-purple-200 mb-4",children:i?"Gestiona estudiantes y su contenido acad\xe9mico":"Supervisa y gestiona los estudiantes de tu grupo asignado"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(null==r?void 0:r.role)==="admin"&&(0,a.jsx)("button",{onClick:S,disabled:w,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 text-white rounded-lg text-sm transition-colors",children:w?"Creando...":"✨ Crear Estudiantes Auto"}),(0,a.jsx)("span",{className:"text-purple-300 text-sm",children:o.length>0&&"".concat(o.length," estudiantes en el grupo")})]})]}),0===o.length?(0,a.jsxs)("div",{className:"text-center py-12 bg-gray-900/30 rounded-xl border border-gray-600/20",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC64"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"No hay estudiantes"}),(0,a.jsx)("p",{className:"text-gray-400 mb-4",children:"No se encontraron estudiantes en este grupo"}),(null==r?void 0:r.role)==="admin"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:S,disabled:w,className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 text-white rounded-lg font-medium transition-colors",children:w?"Creando...":"✨ Crear Estudiantes Autom\xe1ticamente"}),(0,a.jsxs)("p",{className:"text-gray-500 text-sm mt-3",children:["Esto crear\xe1 estudiantes predefinidos para el Grupo ",t]})]})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(e=>(0,a.jsxs)("div",{onClick:()=>b(e),className:"bg-gray-800/50 rounded-xl p-6 border border-gray-600/30 hover:border-purple-500/50 cursor-pointer transition-all duration-200 hover:scale-105 group",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,a.jsx)(g.Z,{user:{id:e.id,displayName:e.full_name,email:e.email},size:"lg"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-white font-semibold text-lg",children:e.full_name||e.email.split("@")[0]}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:e.email})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-green-400 font-medium",children:"\uD83D\uDC64 Estudiante"}),(0,a.jsx)("span",{className:"text-purple-400 group-hover:text-purple-300 transition-colors",children:"Gestionar →"})]})]},e.id))})]})}function A(e){let{groupId:t,currentUser:r}=e,[i,o]=(0,s.useState)([]),[n,d]=(0,s.useState)(null),[c,u]=(0,s.useState)({ensayos:[],videos:[],evidencias:[]}),[m,p]=(0,s.useState)("ensayos"),[x,h]=(0,s.useState)(!0),[b,f]=(0,s.useState)(null),[v,y]=(0,s.useState)(null),[j,N]=(0,s.useState)(null);(0,s.useEffect)(()=>{w()},[t]),(0,s.useEffect)(()=>{n&&D(n.id)},[n]);let w=async()=>{try{let e=(0,l.S)();console.log("[StudentsViewer] groupId:",t,"parseInt:",parseInt(t));let{data:r,error:a,count:s}=await e.from("estudiantes").select("id, codigo, nombre_completo, email, grupo",{count:"exact"}).eq("grupo",parseInt(t)).order("nombre_completo",{ascending:!0});if(console.log("[StudentsViewer] estudiantes data:",r,"error:",a,"count:",s),y("number"==typeof s?s:(null==r?void 0:r.length)||0),N(r||null),a){f("Error loading students: "+a.message),console.error("Error loading students:",a);let{data:r,error:s}=await e.from("users").select("*").eq("group",parseInt(t)).eq("role","usuario").order("email");if(s){f("Error loading users fallback: "+s.message),console.error("Error loading users fallback:",s),o([]);return}let l=(null==r?void 0:r.map(e=>{var r;return{id:e.id,email:e.email,role:e.role,group:(null===(r=e.group)||void 0===r?void 0:r.toString())||t,full_name:e.full_name||e.email}}))||[];o(l);return}let i=(null==r?void 0:r.map(e=>{var r;return{id:e.id,email:e.email,role:"usuario",group:(null===(r=e.grupo)||void 0===r?void 0:r.toString())||t,full_name:e.nombre_completo}}))||[];o(i),f(null)}catch(e){f("Error loading students: "+((null==e?void 0:e.message)||e)),console.error("Error loading students:",e),o([])}finally{h(!1)}},D=async e=>{try{let t=(0,l.S)(),{data:r,error:a}=await t.from("student_essays").select("id, title, file_url, uploaded_at, description").eq("student_id",e);a&&console.error("Error cargando ensayos:",a);let{data:s,error:i}=await t.from("posts").select("id, titulo, contenido, archivos, youtube_url, google_drive_url, fechaCreacion").eq("autor",e);i&&console.error("Error cargando posts:",i);let o=(null==s?void 0:s.filter(e=>e.youtube_url&&""!==e.youtube_url.trim()||e.google_drive_url&&""!==e.google_drive_url.trim()).map(e=>{let t=e.youtube_url&&""!==e.youtube_url.trim(),r=t?e.youtube_url:e.google_drive_url,a=r;if(!t&&e.google_drive_url){let t=e.google_drive_url.match(/\/d\/([a-zA-Z0-9-_]+)/);t&&(a="https://drive.google.com/file/d/".concat(t[1],"/preview"))}return{id:String(e.id),title:e.titulo||"Video sin t\xedtulo",description:e.contenido||"",url:String(r),embedUrl:String(a),type:t?"youtube":"drive",uploaded_at:String(e.fechaCreacion)}}))||[],n=(null==s?void 0:s.filter(e=>e.archivos&&Array.isArray(e.archivos)&&e.archivos.length>0).flatMap(e=>e.archivos.map((t,r)=>({id:"".concat(e.id,"_").concat(r),title:e.titulo||"Evidencia ".concat(r+1),description:e.contenido||"",file_url:t,type:t.toLowerCase().includes(".pdf")?"pdf":"image",uploaded_at:e.fechaCreacion}))))||[];u({ensayos:r||[],videos:o,evidencias:n})}catch(e){console.error("Error loading student work:",e)}};return x?(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})}):n?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-purple-600/20 backdrop-blur-sm rounded-xl p-6 border border-purple-500/30",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>d(null),className:"p-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors",children:"← Volver"}),(0,a.jsx)(g.Z,{user:{id:n.id,displayName:n.full_name||n.email,email:n.email},size:"md"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:n.full_name||n.email}),(0,a.jsx)("p",{className:"text-purple-200",children:"Trabajos y proyectos"})]})]})})}),(0,a.jsx)("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-lg",children:(0,a.jsx)("div",{className:"flex space-x-1 p-1",children:[{id:"ensayos",label:"Ensayos",icon:"\uD83D\uDCC4"},{id:"videos",label:"Videos",icon:"\uD83C\uDFA5"},{id:"evidencias",label:"Evidencias",icon:"\uD83D\uDCC1"}].map(e=>(0,a.jsxs)("button",{onClick:()=>p(e.id),className:"flex items-center space-x-2 px-4 py-3 rounded-lg font-medium transition-all duration-200 ".concat(m===e.id?"bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-slate-700/50"),children:[(0,a.jsx)("span",{children:e.icon}),(0,a.jsx)("span",{children:e.label}),(0,a.jsx)("span",{className:"bg-white/20 px-2 py-1 rounded-full text-xs",children:"ensayos"===e.id?c.ensayos.length:"videos"===e.id?c.videos.length:c.evidencias.length})]},e.id))})}),(0,a.jsxs)("div",{className:"space-y-4",children:["ensayos"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"\uD83D\uDCC4 Ensayos"}),0===c.ensayos.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"\uD83D\uDCC4 No hay ensayos disponibles"}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.ensayos.map(e=>(0,a.jsxs)("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-gray-600/30",children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-2",children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-gray-300 text-sm mb-3",children:e.description}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm mb-3",children:["\uD83D\uDCC5 ",new Date(e.uploaded_at).toLocaleDateString()]}),(0,a.jsx)("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:"\uD83D\uDCD6 Ver ensayo →"})]},e.id))})]}),"videos"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"\uD83C\uDFA5 Videos"}),0===c.videos.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"\uD83C\uDFA5 No hay videos disponibles"}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.videos.map(e=>{var t;return(0,a.jsxs)("div",{className:"bg-gray-900/50 rounded-lg overflow-hidden border border-gray-600/30",children:[(0,a.jsx)("div",{className:"aspect-video bg-gray-800",children:"youtube"===e.type&&e.embedUrl?(0,a.jsx)("iframe",{src:"https://www.youtube.com/embed/".concat((null===(t=e.embedUrl.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/))||void 0===t?void 0:t[1])||""),title:e.title,className:"w-full h-full",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):"drive"===e.type&&e.embedUrl?(0,a.jsx)("iframe",{src:e.embedUrl,title:e.title,className:"w-full h-full",frameBorder:"0",allow:"autoplay"}):(0,a.jsx)("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center text-gray-400",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83C\uDFA5"}),(0,a.jsx)("div",{children:"Video no disponible"})]})})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-2",children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:e.description}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm mb-3",children:["youtube"===e.type?"\uD83D\uDCF9 YouTube":"\uD83D\uDCBE Google Drive"," • ",new Date(e.uploaded_at).toLocaleDateString()]}),(0,a.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:"youtube"===e.type?"\uD83D\uDD17 Ver en YouTube →":"\uD83D\uDD17 Ver en Drive →"})]})]},e.id)})})]}),"evidencias"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"\uD83D\uDCC1 Evidencias"}),0===c.evidencias.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-400",children:"\uD83D\uDCC1 No hay evidencias disponibles"}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.evidencias.map(e=>(0,a.jsxs)("div",{className:"bg-gray-900/50 rounded-lg overflow-hidden border border-gray-600/30",children:[(0,a.jsx)("div",{className:"aspect-square bg-gray-800 flex items-center justify-center",children:"image"===e.type?(0,a.jsx)("img",{src:e.file_url,alt:e.title,className:"w-full h-full object-cover"}):(0,a.jsxs)("div",{className:"text-center text-gray-400",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"pdf"===e.type?"\uD83D\uDCC4":"\uD83D\uDCCB"}),(0,a.jsx)("div",{className:"text-sm",children:e.type.toUpperCase()})]})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h4",{className:"text-white font-medium mb-2",children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:e.description}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm mb-3",children:["\uD83D\uDCC5 ",new Date(e.uploaded_at).toLocaleDateString()]}),(0,a.jsx)("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded transition-colors",children:"\uD83D\uDCD6 Ver evidencia →"})]})]},e.id))})]})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-purple-600/20 backdrop-blur-sm rounded-xl p-6 border border-purple-500/30",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-white mb-2 flex items-center gap-2",children:["\uD83D\uDC65 Integrantes del Grupo ",t]}),(0,a.jsx)("p",{className:"text-purple-200 mb-4",children:"Explora los trabajos y proyectos de tus compa\xf1eros de grupo"}),(0,a.jsxs)("div",{className:"text-xs text-gray-300",children:["Fetched: ",null!=v?v:"-"," rows"]}),j&&(0,a.jsxs)("details",{className:"text-xs text-gray-400 mt-2 bg-slate-800/40 p-2 rounded",children:[(0,a.jsx)("summary",{className:"cursor-pointer",children:"Ver respuesta cruda (debug)"}),(0,a.jsx)("pre",{className:"text-xs whitespace-pre-wrap max-h-48 overflow-auto",children:JSON.stringify(j,null,2)})]}),b&&(0,a.jsxs)("div",{className:"bg-red-900/40 text-red-300 p-2 rounded mt-2",children:[(0,a.jsx)("strong",{children:"Error:"})," ",b]})]}),0===i.length?(0,a.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC65"}),(0,a.jsx)("div",{className:"text-xl mb-2",children:"No hay estudiantes registrados"}),(0,a.jsx)("div",{className:"text-sm",children:"Este grupo a\xfan no tiene miembros"}),b&&(0,a.jsxs)("div",{className:"bg-red-900/40 text-red-300 p-2 rounded mt-4",children:[(0,a.jsx)("strong",{children:"Error:"})," ",b]})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(e=>(0,a.jsxs)("div",{onClick:()=>d(e),className:"bg-slate-800/50 backdrop-blur-sm rounded-lg p-4 border border-slate-600/30 hover:border-purple-500/50 transition-all duration-200 cursor-pointer hover:bg-slate-700/50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)(g.Z,{user:{id:e.id,displayName:e.full_name||e.email,email:e.email},size:"sm"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-white font-medium",children:e.full_name||e.email}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"Estudiante"})]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-300",children:"\uD83D\uDC41️ Ver trabajos →"})]},e.id))})]})}let I=(0,_.default)(()=>r.e(587).then(r.bind(r,9587)),{loadableGenerated:{webpack:()=>[9587]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})})}),L=(0,_.default)(()=>r.e(269).then(r.bind(r,8269)),{loadableGenerated:{webpack:()=>[8269]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})})}),M=[{id:1,name:"Grupo 1",description:"",topic:"",members:["Vilca Cruz Marsia Gianella Katherine","Luna Viilca Sahara Dula","Romani Medina Nadit Liliana","Maza Morales Benjamin Pedro","Damjanovic Burga Yenko Branko","Navarro Cespedes Sunny Adriana"],color:"from-blue-500 to-cyan-600",icon:"\uD83E\uDD16"},{id:2,name:"Grupo 2",description:"",topic:"",members:["Palomino Huamani Judit Gabriela","Asuncion Pomasonco Allison Giselle","Martinez Gomez Alvaro Jose","Yaranga Mejia Zharick Scarlett","Maquera Mendoza Bryan Antony","Luque Leayza David Mauricio"],color:"from-green-500 to-emerald-600",icon:"\uD83C\uDF31"},{id:3,name:"Grupo 3",description:"",topic:"",members:["Quispe Abtao Jhack Hildibrahan","Reyes Mendieta Karla Fernanda","Hanampa Bellido Luz Berli","Gonzales Lopez Lulio Main","Ballon Ramos Robert Andres"],color:"from-purple-500 to-violet-600",icon:"⚕️"},{id:4,name:"Grupo 4",description:"",topic:"",members:["Martinez Lugue Claudia Alexandra","Morales Damian Andrea Katherine","Josue Osorio Anghely Cristal","Espinoza Carde\xf1a Alessandra Abyael","Granada Juarez Alejandra"],color:"from-pink-500 to-rose-600",icon:"\uD83D\uDCDA"},{id:5,name:"Grupo 5",description:"",topic:"",members:["Balbin Cueva Aaron","Carrillo Castillo Brenda","Hurtado Dominguez Angel Valeria","Marcelo Diego Francesco","Medina Vera Arturo Alexis","Obregon Castro Jhesbelt Anadira","Ramon Ipushima Ilan Yefet"],color:"from-orange-500 to-amber-600",icon:"⛓️"}];function T(e){let{groupId:t}=e,[r,i]=(0,s.useState)([]),[d,u]=(0,s.useState)(0),[m,p]=(0,s.useState)("inicio"),[g,x]=(0,s.useState)(!1),[h,b]=(0,s.useState)(null),[v,y]=(0,s.useState)(!1),{user:N,role:w,group:D}=(0,j.a)(),_=(0,s.useMemo)(()=>M.find(e=>e.id===t),[t]),C=(0,s.useCallback)(()=>{u(e=>e+1)},[]),k=(0,s.useMemo)(()=>"admin"===w||"delegado"===w,[w]),T=(0,s.useCallback)(e=>!!N&&("admin"===w||"delegado"===w&&D===e.grupo),[N,w,D]),U=(0,s.useMemo)(()=>r.filter(e=>!!("published"===e.status||"draft"===e.status&&T(e))),[r,T]);(0,s.useEffect)(()=>{if("posts"!==m)return;let e=!0;x(!0),b(null);let r=null;return(async()=>{try{return function(e,t){let r=(0,l.S)(),a=r.channel("posts-grupo-".concat(e)).on("postgres_changes",{event:"*",schema:"public",table:"posts",filter:"grupo=eq.".concat(e)},async()=>{o.invalidate("posts_".concat(e)),t(await n(e))}).subscribe(),s=o.get("posts_".concat(e));return s&&t(s),n(e).then(t).catch(console.error),()=>{r.removeChannel(a)}}(t,t=>{e&&(i(t),x(!1))})}catch(t){e&&(b(t instanceof Error?t.message:"Error cargando posts"),x(!1))}})().then(e=>{"function"==typeof e&&(r=e)}),()=>{e=!1,r&&r()}},[t,d,m]);let V=(0,s.useCallback)(e=>async r=>{try{let a=await c("post",t,e,r);i(t=>t.map(t=>t.id===e?{...t,reacciones:a}:t))}catch(e){console.error("Error reacting to post:",e)}},[t]),G=(0,s.useCallback)(async e=>{let a=r.find(t=>t.id===e);if(!a||!T(a)){alert("No tienes permisos para publicar esta publicaci\xf3n");return}try{let r=(0,l.S)(),{error:a}=await r.from("posts").update({status:"published"}).eq("id",e).eq("grupo",t);if(a)throw a;i(t=>t.map(t=>t.id===e?{...t,status:"published"}:t))}catch(e){console.error("Error publicando post:",e),alert("Error al publicar la publicaci\xf3n")}},[r,T,t]),R=(0,s.useCallback)(async e=>{let t=r.find(t=>t.id===e);if(t){if(!("admin"===w||"delegado"===w&&t.autor===(null==N?void 0:N.id))){alert("No tienes permisos para eliminar esta publicaci\xf3n");return}try{let t=(0,l.S)(),{error:r}=await t.from("posts").delete().eq("id",e);if(r)throw r;i(t=>t.filter(t=>t.id!==e)),alert("✅ Publicaci\xf3n eliminada correctamente")}catch(e){console.error("Error eliminando post:",e),alert("❌ Error al eliminar la publicaci\xf3n")}}},[r,w,null==N?void 0:N.email,t]);return(0,a.jsxs)("section",{className:"space-y-6 animate-fade-in",children:[(0,a.jsx)("div",{className:"glass-card p-6 md:p-8",children:(0,a.jsxs)("div",{className:"flex items-start space-x-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-gradient-to-r ".concat(null==_?void 0:_.color," flex items-center justify-center shadow-lg"),children:(0,a.jsx)("span",{className:"text-3xl",children:null==_?void 0:_.icon})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-token mb-1",children:null==_?void 0:_.name}),(0,a.jsx)("h2",{className:"text-lg md:text-xl font-semibold",style:{color:"var(--chip-text)"},children:null==_?void 0:_.topic}),(0,a.jsx)("p",{className:"muted-token mt-2 mb-4",children:null==_?void 0:_.description}),(0,a.jsxs)("div",{className:"post-card p-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold mb-2 flex items-center text-token",children:[(0,a.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full mr-2"}),"Integrantes del Grupo"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:null==_?void 0:_.members.map((e,t)=>(0,a.jsx)("div",{className:"chip",children:e},t))})]})]})]})}),(0,a.jsx)("div",{className:"glass-card p-2",children:(0,a.jsx)("div",{className:"tabbar",children:[{id:"inicio",label:"Inicio",icon:"\uD83C\uDFE0"},{id:"posts",label:"Publicaciones",icon:"\uD83D\uDCDD"},{id:"integrantes",label:"Integrantes",icon:"\uD83D\uDC65"}].map(e=>(0,a.jsxs)("button",{onClick:()=>p(e.id),className:"tab-btn ".concat(m===e.id?"active":""),children:[(0,a.jsx)("span",{children:e.icon}),(0,a.jsx)("span",{className:"text-sm font-medium",children:e.label})]},e.id))})}),"inicio"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[("admin"===w||"delegado"===w)&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:()=>y(!v),className:"px-4 py-2 rounded-lg font-medium transition-all duration-200 ".concat(v?"bg-green-500 hover:bg-green-600 text-white":"bg-purple-500 hover:bg-purple-600 text-white"),children:v?"✅ Guardar cambios":"✏️ Editar p\xe1gina"})}),(0,a.jsx)("div",{className:"post-card p-6",children:v&&("admin"===w||"delegado"===w)?(0,a.jsx)(L,{groupId:t,currentUser:N,isEditMode:v,onToggleEdit:()=>y(!v),groupTopic:(null==_?void 0:_.topic)||""}):(0,a.jsx)(I,{groupId:t,groupTopic:(null==_?void 0:_.topic)||"",currentUser:N})})]}),"posts"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"glass-card p-4",children:(0,a.jsx)(S,{groupId:t,onPostCreated:C})}),g?(0,a.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-500"}),(0,a.jsx)("span",{className:"ml-3 text-gray-400",children:"Cargando publicaciones..."})]}):h?(0,a.jsx)("div",{className:"glass-card p-6",style:{borderColor:"rgba(239,68,68,0.35)"},children:(0,a.jsxs)("div",{className:"text-red-400 text-center",children:[(0,a.jsx)("p",{className:"font-semibold",children:"Error al cargar los datos"}),(0,a.jsx)("p",{className:"text-sm mt-2",children:h}),(0,a.jsx)("button",{onClick:C,className:"mt-4 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors",children:"Reintentar"})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[U.map(e=>(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(f,{post:e,onReact:V(e.id),canPublish:T(e),onPublish:()=>G(e.id),canDelete:"admin"===w||e.autor===(null==N?void 0:N.id),onDelete:()=>R(e.id),currentUserId:(null==N?void 0:N.id)||void 0,currentUserRole:w||void 0})},e.id)),!U.length&&!g&&(0,a.jsx)("p",{className:"muted-token text-sm text-center py-8 animate-fade-in",children:"No hay publicaciones todav\xeda."})]})]}),"integrantes"===m&&(0,a.jsx)("div",{className:"space-y-6",children:k?(0,a.jsxs)("div",{className:"post-card p-6",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold text-token mb-4 flex items-center",children:[(0,a.jsx)("span",{className:"text-2xl mr-3",children:"⚙️"}),"Gesti\xf3n de Estudiantes"]}),(0,a.jsx)(E,{groupId:t.toString(),currentUser:N})]}):(0,a.jsx)("div",{className:"post-card p-6",children:(0,a.jsx)(A,{groupId:t.toString(),currentUser:N})})})]})}},5506:function(e,t,r){r.d(t,{RC:function(){return i}});var a=r(1180),s=r(3259);class l{static getInstance(){return l.instance||(l.instance=new l),l.instance}setUser(e){this.user=e}loadLogsFromStorage(){try{let e=window.localStorage.getItem("audit_logs");e&&(this.logs=JSON.parse(e))}catch(e){console.error("Error loading logs from storage:",e)}}saveLogsToStorage(){try{let e=this.logs.slice(-1e3);window.localStorage.setItem("audit_logs",JSON.stringify(e)),this.logs=e}catch(e){console.error("Error saving logs to storage:",e)}}async log(e){var t,r;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={id:crypto.randomUUID(),timestamp:new Date().toISOString(),user_id:(null===(t=this.user)||void 0===t?void 0:t.id)||"anonymous",user_email:(null===(r=this.user)||void 0===r?void 0:r.email)||"unknown",action:e,level:s,details:l,ip_address:"local",user_agent:navigator.userAgent};this.logs.push(i),this.saveLogsToStorage();try{let e=(0,a.S)();await e.from("logs").insert({id:i.id,timestamp:i.timestamp,user_id:i.user_id,user_email:i.user_email,action:i.action,level:i.level,details:i.details,ip_address:i.ip_address,user_agent:i.user_agent})}catch(e){console.warn("No se pudo guardar el log en Supabase:",e)}("critical"===s||"error"===s)&&console.error("[AUDIT ".concat(s.toUpperCase(),"]"),e,l)}getLogs(e){let t=[...this.logs];return(null==e?void 0:e.level)&&(t=t.filter(t=>t.level===e.level)),(null==e?void 0:e.action)&&(t=t.filter(t=>t.action===e.action)),(null==e?void 0:e.userId)&&(t=t.filter(t=>t.user_id===e.userId)),t.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()),(null==e?void 0:e.limit)&&(t=t.slice(0,e.limit)),t}getStats(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(e.getTime()-6048e5);return{total:this.logs.length,today:this.logs.filter(e=>new Date(e.timestamp)>=t).length,thisWeek:this.logs.filter(e=>new Date(e.timestamp)>=r).length,errors:this.logs.filter(e=>"error"===e.level||"critical"===e.level).length,byLevel:{info:this.logs.filter(e=>"info"===e.level).length,warning:this.logs.filter(e=>"warning"===e.level).length,error:this.logs.filter(e=>"error"===e.level).length,critical:this.logs.filter(e=>"critical"===e.level).length},byAction:this.logs.reduce((e,t)=>(e[t.action]=(e[t.action]||0)+1,e),{})}}clearLogs(){this.logs=[],window.localStorage.removeItem("audit_logs")}exportLogs(){let e=new Blob([JSON.stringify(this.logs,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="audit_logs_".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}constructor(){this.user=null,this.logs=[],this.loadLogsFromStorage()}}function i(){let{user:e}=(0,s.a)(),t=l.getInstance();return e&&t.setUser(e),{log:t.log.bind(t),getLogs:t.getLogs.bind(t),getStats:t.getStats.bind(t),clearLogs:t.clearLogs.bind(t),exportLogs:t.exportLogs.bind(t)}}t.ZP=l}}]);