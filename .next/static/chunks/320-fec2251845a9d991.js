"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[320],{6758:function(e,r,l){l.d(r,{Z:function(){return u}});var o=l(7437),n=l(2265),a=l(9831);let t=[{id:1,backgroundColor:"#8B5CF6",skinTone:"#FFB5A7",hairColor:"#F97316",shirtColor:"#84CC16"},{id:2,backgroundColor:"#3B82F6",skinTone:"#FED7AA",hairColor:"#92400E",shirtColor:"#EF4444"},{id:3,backgroundColor:"#10B981",skinTone:"#F3E8FF",hairColor:"#1F2937",shirtColor:"#F59E0B"},{id:4,backgroundColor:"#F59E0B",skinTone:"#FEE2E2",hairColor:"#7C2D12",shirtColor:"#06B6D4"},{id:5,backgroundColor:"#EC4899",skinTone:"#DBEAFE",hairColor:"#FCD34D",shirtColor:"#8B5CF6"},{id:6,backgroundColor:"#6366F1",skinTone:"#FEF3C7",hairColor:"#059669",shirtColor:"#DC2626"},{id:7,backgroundColor:"#14B8A6",skinTone:"#FCE7F3",hairColor:"#B45309",shirtColor:"#7C3AED"},{id:8,backgroundColor:"#F97316",skinTone:"#E0E7FF",hairColor:"#374151",shirtColor:"#059669"}];function i(e){let{avatar:r,size:l=40}=e;return(0,o.jsxs)("svg",{width:l,height:l,viewBox:"0 0 100 100",className:"rounded-full",children:[(0,o.jsx)("circle",{cx:"50",cy:"50",r:"50",fill:r.backgroundColor}),(0,o.jsx)("ellipse",{cx:"50",cy:"45",rx:"20",ry:"25",fill:r.skinTone}),(0,o.jsx)("ellipse",{cx:"50",cy:"28",rx:"22",ry:"18",fill:r.hairColor}),(0,o.jsx)("circle",{cx:"44",cy:"40",r:"2",fill:"#000"}),(0,o.jsx)("circle",{cx:"56",cy:"40",r:"2",fill:"#000"}),(0,o.jsx)("ellipse",{cx:"50",cy:"50",rx:"3",ry:"2",fill:"#000"}),(0,o.jsx)("circle",{cx:"32",cy:"45",r:"4",fill:r.skinTone}),(0,o.jsx)("circle",{cx:"68",cy:"45",r:"4",fill:r.skinTone}),(0,o.jsx)("ellipse",{cx:"50",cy:"85",rx:"25",ry:"20",fill:r.shirtColor}),(0,o.jsx)("rect",{x:"45",y:"65",width:"10",height:"8",fill:r.skinTone})]})}var u=(0,n.memo)(function(e){let{user:r,role:l=null,size:n="md",showRole:u=!1,className:s=""}=e,c={sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-12 h-12 text-base",xl:"w-16 h-16 text-lg"},d={sm:"text-xs",md:"text-sm",lg:"text-base",xl:"text-xl"};if(!r)return(0,o.jsx)("div",{className:"".concat(c[n]," rounded-full bg-gray-500 flex items-center justify-center ").concat(s),children:(0,o.jsx)("span",{className:"text-white",children:"\uD83D\uDC64"})});let D=function(e){let r=Math.abs(e.split("").reduce((e,r)=>(e=(e<<5)-e+r.charCodeAt(0))&e,0))%t.length;return t[r]}(r.id);return r.avatar?(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("div",{className:"".concat(c[n]," rounded-full flex items-center justify-center font-bold text-white ").concat(s),style:{backgroundColor:r.avatar.color},children:(0,o.jsx)("span",{className:d[n],children:r.avatar.emoji})}),u&&l&&"anonimo"!==l&&(0,o.jsx)("div",{className:"absolute -bottom-1 -right-1 ".concat(d[n]," bg-gradient-to-r ").concat((0,a.X0)(l)," rounded-full p-1"),children:(0,o.jsx)("span",{children:(0,a.c1)(l)})})]}):(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("div",{className:"".concat(c[n]," overflow-hidden ").concat(s),children:(0,o.jsx)(i,{avatar:D,size:{sm:32,md:40,lg:48,xl:64}[n]})}),u&&l&&"usuario"!==l&&"anonimo"!==l&&(0,o.jsx)("div",{className:"absolute -bottom-1 -right-1 ".concat(d[n]," bg-gradient-to-r ").concat((0,a.X0)(l)," rounded-full p-1 border-2 border-white"),children:(0,o.jsx)("span",{children:(0,a.c1)(l)})})]})})},3259:function(e,r,l){l.d(r,{H:function(){return u},a:function(){return s}});var o=l(7437),n=l(2265),a=l(1180),t=l(9831);let i=(0,n.createContext)({user:null,role:null,group:null,loading:!0,isAnonymous:!1});function u(e){let{children:r}=e,[l,u]=(0,n.useState)(null),[s,c]=(0,n.useState)(null),[d,D]=(0,n.useState)(!0),[m,C]=(0,n.useState)(!1),h=()=>{try{let e=localStorage.getItem("anonymousUser");return e?JSON.parse(e):null}catch(e){return null}},f=()=>{let e=(0,t.M7)(),r=(0,t.Bm)(),l={id:"anon_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),displayName:e,avatar:r};return localStorage.setItem("anonymousUser",JSON.stringify(l)),l};(0,n.useEffect)(()=>{let e=!0;(async()=>{try{var r,l,o,n,t,i;let s=(0,a.S)(),{data:d}=await s.auth.getSession(),D=null!==(l=null===(r=d.session)||void 0===r?void 0:r.user)&&void 0!==l?l:null;if(!e)return;if(D){C(!1),await s.from("users").upsert({id:D.id,email:null!==(t=D.email)&&void 0!==t?t:null},{onConflict:"id"});let{data:e}=await s.from("users").select("*").eq("id",D.id).limit(1),r=null==e?void 0:e[0];console.log("\uD83D\uDD0D Auth Debug - Usuario encontrado en DB:",r),console.log("\uD83D\uDD0D Auth Debug - Email:",D.email,"Role:",null==r?void 0:r.role),c(null!=r?r:{role:"usuario",email:null!==(i=D.email)&&void 0!==i?i:void 0});let l=(null==D?void 0:null===(o=D.user_metadata)||void 0===o?void 0:o.full_name)||(null==D?void 0:null===(n=D.user_metadata)||void 0===n?void 0:n.name),a=(null==r?void 0:r.displayName)||l||(D.email?D.email.split("@")[0]:void 0);u({id:D.id,email:D.email,displayName:a})}else{let e=h();e||(e=f()),e&&(u(e),C(!0),c({role:"anonimo",displayName:e.displayName,avatar:e.avatar}))}}catch(l){console.error("Error en inicializaci\xf3n de auth:",l);let r=f();r&&e&&(u(r),C(!0),c({role:"anonimo",displayName:r.displayName,avatar:r.avatar}))}finally{e&&D(!1)}})();let{data:r}=(0,a.S)().auth.onAuthStateChange((r,l)=>{var o,n,a;if(!e)return;let t=null!==(o=null==l?void 0:l.user)&&void 0!==o?o:null;if(t){let e=(null==t?void 0:null===(n=t.user_metadata)||void 0===n?void 0:n.full_name)||(null==t?void 0:null===(a=t.user_metadata)||void 0===a?void 0:a.name)||(t.email?t.email.split("@")[0]:void 0);u({id:t.id,email:t.email,displayName:e}),C(!1)}else{let e=h();e||(e=f()),e&&(u(e),C(!0),c({role:"anonimo",displayName:e.displayName,avatar:e.avatar}))}});return()=>{e=!1,r.subscription.unsubscribe()}},[]);let F=(0,n.useMemo)(()=>{var e,r;return{user:l,role:null!==(e=null==s?void 0:s.role)&&void 0!==e?e:null,group:null!==(r=null==s?void 0:s.group)&&void 0!==r?r:null,loading:d,isAnonymous:m}},[null==l?void 0:l.id,null==l?void 0:l.email,null==s?void 0:s.role,null==s?void 0:s.group,d,m]);return(0,o.jsx)(i.Provider,{value:F,children:r})}function s(){return(0,n.useContext)(i)}},9831:function(e,r,l){l.d(r,{Bm:function(){return u},M7:function(){return i},UJ:function(){return s},X0:function(){return c},c1:function(){return d}});let o=["Silent","Swift","Brave","Wild","Cool","Smart","Bold","Quick","Dark","Bright","Strong","Fast","Calm","Sharp","Wise","Fierce","Noble","Epic","Magic","Crystal","Storm","Fire","Ice","Thunder","Shadow","Light","Golden","Silver","Mystic","Cyber","Neon","Cosmic","Rebel","Alpha","Beta","Delta","Omega","Phoenix","Dragon","Wolf","Eagle","Shark","Tiger","Lion","Hawk","Raven","Viper","Falcon"],n=["Hunter","Warrior","Knight","Mage","Archer","Fighter","Guardian","Defender","Champion","Hero","Legend","Master","Ghost","Phantom","Ranger","Scout","Sniper","Pilot","Captain","Admiral","General","Commander","Agent","Ninja","Samurai","Viking","Spartan","Titan","Storm","Blaze","Frost","Thunder","Lightning","Eclipse","Nova","Comet","Meteor","Star","Galaxy","Cosmos","Void","Prism","Nexus","Matrix","Core","Edge","Pulse","Wave","Surge","Force","Power"],a=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA","#F1948A","#85C1E9","#D7BDE2","#A9DFBF","#F9E79F","#AED6F1"],t=["\uD83C\uDFAE","\uD83D\uDE80","⭐","\uD83D\uDD25","⚡","\uD83C\uDF1F","\uD83D\uDC8E","\uD83C\uDFAF","\uD83C\uDFAA","\uD83C\uDFA8","\uD83C\uDFB5","\uD83C\uDFB2","\uD83C\uDFB8","\uD83C\uDFAD","\uD83C\uDFBA","\uD83C\uDFBB","\uD83C\uDFC6","\uD83C\uDFC5","\uD83C\uDF96️","\uD83D\uDC51","\uD83E\uDD84","\uD83E\uDD8B","\uD83E\uDD85","\uD83E\uDD8A","\uD83D\uDC3A","\uD83E\uDD81","\uD83D\uDC05","\uD83E\uDD88","\uD83D\uDC09","\uD83D\uDD2E","\uD83D\uDCAB","\uD83C\uDF08","\uD83C\uDF40","\uD83C\uDF38","\uD83C\uDF3A","\uD83C\uDF3B","\uD83C\uDF44","\uD83C\uDF35","\uD83C\uDF83","❄️"];function i(){let e=o[Math.floor(Math.random()*o.length)],r=n[Math.floor(Math.random()*n.length)];return"".concat(e).concat(r).concat(Math.floor(999*Math.random())+1)}function u(){return{color:a[Math.floor(Math.random()*a.length)],emoji:t[Math.floor(Math.random()*t.length)]}}function s(e){switch(e){case"admin":return"Administrador";case"delegado":return"Delegado";case"usuario":return"Estudiante";default:return"Invitado"}}function c(e){switch(e){case"admin":return"from-purple-500 to-pink-500";case"delegado":return"from-blue-500 to-cyan-500";case"usuario":return"from-green-500 to-teal-500";default:return"from-gray-500 to-gray-600"}}function d(e){switch(e){case"admin":return"\uD83D\uDC51";case"delegado":return"\uD83C\uDFAF";case"usuario":return"\uD83D\uDCDA";default:return"\uD83D\uDC64"}}},1180:function(e,r,l){l.d(r,{S:function(){return a}});var o=l(2835);let n=null;function a(){if(n)return n;let e="https://cjdiysajgoqqoebwyeae.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNqZGl5c2FqZ29xcW9lYnd5ZWFlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NTAzODAsImV4cCI6MjA3NTQyNjM4MH0.flnUk4t0YKucb3EQD4dAOkd-3_9KvbA6pTSDoqG-ezo";if(!e||!r)throw Error("Faltan NEXT_PUBLIC_SUPABASE_URL o NEXT_PUBLIC_SUPABASE_ANON_KEY");return n=(0,o.eI)(e,r,{auth:{persistSession:!0,autoRefreshToken:!0}})}}}]);